<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://finger-bone.github.io/micro-service-crashcourse/19/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>后端框架一览 - 微服务速成笔记</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/color-brewer.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">微服务速成笔记</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Spring Cloud 微服务技术 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../01/" class="dropdown-item">回到 Spring</a>
</li>
                                    
<li>
    <a href="../02/" class="dropdown-item">回到 Java</a>
</li>
                                    
<li>
    <a href="../03/" class="dropdown-item">Consul 作为服务注册中心</a>
</li>
                                    
<li>
    <a href="../04/" class="dropdown-item">Consul 作为配置中心</a>
</li>
                                    
<li>
    <a href="../05/" class="dropdown-item">LoadBalancer</a>
</li>
                                    
<li>
    <a href="../06/" class="dropdown-item">Http Interface Client 与 OpenFeign</a>
</li>
                                    
<li>
    <a href="../07/" class="dropdown-item">Resilience4j 服务熔断和降级</a>
</li>
                                    
<li>
    <a href="../08/" class="dropdown-item">Resilience4j 限流</a>
</li>
                                    
<li>
    <a href="../09/" class="dropdown-item">Micrometer 监控</a>
</li>
                                    
<li>
    <a href="../10/" class="dropdown-item">Spring Gateway 网关</a>
</li>
                                    
<li>
    <a href="../11/" class="dropdown-item">Seata 分布式事务</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Spring 进阶内容 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../12/" class="dropdown-item">Reactor 框架</a>
</li>
                                    
<li>
    <a href="../13/" class="dropdown-item">Spring WebFlux</a>
</li>
                                    
<li>
    <a href="../14/" class="dropdown-item">Spring Security</a>
</li>
                                    
<li>
    <a href="../15/" class="dropdown-item">Spring Security OAuth2 认证以及 KeyCloak 用户服务</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">其它中间件 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../16/" class="dropdown-item">Rabbit MQ 消息队列</a>
</li>
                                    
<li>
    <a href="../17/" class="dropdown-item">GraphQL</a>
</li>
                                    
<li>
    <a href="../18/" class="dropdown-item">gRPC</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">k8s 微服务技术 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">后端框架一览</a>
</li>
                                    
<li>
    <a href="../20/" class="dropdown-item">k8s 无状态服务基本部署</a>
</li>
                                    
<li>
    <a href="../21/" class="dropdown-item">helm 打包 istio 网关与 k8s 命令行工具</a>
</li>
                                    
<li>
    <a href="../22/" class="dropdown-item">k8s 无状态服务</a>
</li>
                                    
<li>
    <a href="../23/" class="dropdown-item">k8s 有状态服务</a>
</li>
                                    
<li>
    <a href="../24/" class="dropdown-item">服务网格</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">中间件补充 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../25/" class="dropdown-item">Nacos 服务治理</a>
</li>
                                    
<li>
    <a href="../26/" class="dropdown-item">Sentinel</a>
</li>
                                    
<li>
    <a href="../27/" class="dropdown-item">kafka 高性能消息队列</a>
</li>
                                    
<li>
    <a href="../28/" class="dropdown-item">Redis</a>
</li>
                                    
<li>
    <a href="../29/" class="dropdown-item">OTel-LGTM</a>
</li>
                                    
<li>
    <a href="../30/" class="dropdown-item">Dubbo RPC</a>
</li>
                                    
<li>
    <a href="../31.md" class="dropdown-item">Nginx</a>
</li>
                                    
<li>
    <a href="../32.md" class="dropdown-item">Treafik</a>
</li>
                                    
<li>
    <a href="../33.md" class="dropdown-item">Citus</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../18/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../20/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#ch19" class="nav-link">微服务速成 Ch19 后端框架一览</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#spring" class="nav-link">Spring</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#express" class="nav-link">Express</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hono" class="nav-link">Hono</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#fiber" class="nav-link">Fiber</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#fastapi" class="nav-link">FastAPI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ch19">微服务速成 Ch19 后端框架一览</h1>
<p>现在，我们对 Spring 与 Java 技术栈的学习正式结束。下一部分是基于 k8s 的微服务。但为了避免大量的 boilerplate，我们不再使用 Spring 开发。之后，我们会使用 Javascript 的 hono 框架来进行 k8s 微服务的实现。</p>
<p>在这一章中，我们会对后端框架进行一个简单的概览。这些框架都是后端开发中常用的框架，但是我们不会深入讲解。</p>
<p>现代的后端框架基本都是基于函数式编程的，而非像 Spring 一样面向对象并基于注解。诚然，Spring 现在也提供了函数式路由，但用的人很少。</p>
<h2 id="spring">Spring</h2>
<p>我们前面已经学习过了 Java 和其技术栈上的 Spring 框架。</p>
<h2 id="express">Express</h2>
<p>Express 是一个简洁而灵活的 Node.js Web 应用程序框架。</p>
<p>首先创建一个 Node.js 项目，并安装 Express。这里我们一并带上 Typescript。</p>
<pre><code class="language-bash">npm init -y
npm install express
npm install typescript
</code></pre>
<p>然后，创建一个<code>app.ts</code>文件，</p>
<pre><code class="language-typescript">import express from 'express';

const app = express();
const port = 3000;

app.get('/', (req, res) =&gt; {
    res.send('Hello World!');
});

app.listen(port, () =&gt; {
    console.log(`Example app listening at http://localhost:${port}`);
});
</code></pre>
<p>可以看到，函数式的后端开发是基于回调的。在<code>express</code>中，使用<code>app.get</code>来定义路由，然后传入一个回调函数。</p>
<p>express 的回调函数的参数是<code>req</code>和<code>res</code>，分别是请求和响应。在这里，我们返回了一个字符串。</p>
<p><code>req</code>对象表示 HTTP 请求，包含了请求的信息，例如 URL、HTTP 头和请求体。<code>res</code>对象表示 HTTP 响应，用于发送响应数据。</p>
<p>如果要获取参数，</p>
<pre><code class="language-typescript">app.get('/hello/:name', (req, res) =&gt; {
    res.send(`Hello, ${req.params.name}`);
});
app.get('/hello', (req, res) =&gt; {
    const name = req.query.name;
    res.send(`Hello, ${name}`);
});
app.post('/hello', (req, res) =&gt; {
    const name = req.body.name;
    res.send(`Hello, ${name}`);
});
</code></pre>
<p>如果要发送 JSON 或者其他数据，</p>
<pre><code class="language-typescript">app.get('/json', (req, res) =&gt; {
    res.json({ message: 'Hello World!' });
});
app.get('/file', (req, res) =&gt; {
    res.sendFile('path/to/file');
});
</code></pre>
<p>对于数据库 client，这里使用 postgres，只要，</p>
<pre><code class="language-typescript">import { Client } from 'pg';

const client = new Client();
client.connect();

app.get('/db', async (req, res) =&gt; {
    const result = await client.query('SELECT * FROM table');
    res.json(result.rows);
});
</code></pre>
<p>没有复杂的依赖注入，闭包的捕获代替了依赖注入。</p>
<h2 id="hono">Hono</h2>
<p>Express 是 Node.js 的框架，而 Hono 可以说是 Bun 的代表框架。</p>
<p>Bun 是一个新兴的 JavaScript 运行时，比起 Node.js 强大很多。一方面，它速度快；另一方面，它还有许多内置特性，例如原生支持 Typescript。此外，Bun 目前与 Node.js 在除了 v8 引擎的所有方面都基本是完全兼容的。此外，Bun 的命令也和 Node.js 或 npm 基本一致，完全没有学习成本。</p>
<p>Hono 是一个新的 Web 后端框架，也是函数式的。当然，它也支持基于 Node.js。</p>
<pre><code class="language-typescript">const app = new Hono()
app.get('/', (c) =&gt; c.text('Hello Bun!'))

export default app
</code></pre>
<p>最后，使用<code>bun run dev</code>启动服务即可。</p>
<p>这里的<code>c</code>是一个上下文对象，它包含了请求和响应的所有信息。<code>c.text</code>是一个快捷方法，用于返回文本。</p>
<p>如果要获取参数，</p>
<pre><code class="language-typescript">import { Hono } from 'hono'

const app = new Hono()

app.get('/hello/:name', async (c) =&gt; c.text(`Hello, ${c.req.param('name')}`))
app.get('/hello', async (c) =&gt; {
    const name = c.req.query('name')
    return c.text(`Hello, ${name}`)
})
app.post('/hello', async (c) =&gt; {
    const body = await c.req.parseBody()
    const name = body.name
    return c.text(`Hello, ${name}`)
})

export default app
</code></pre>
<p>之后我们会使用 Hono 来开发 k8s 微服务。</p>
<h2 id="fiber">Fiber</h2>
<p>Fiber 是 Go 语言的 Web 框架之一，它是 Go 语言后端框架中并发最高的。</p>
<pre><code class="language-go">package main

import &quot;github.com/gofiber/fiber/v2&quot;

func main() {
    app := fiber.New()

    app.Get(&quot;/&quot;, func(c *fiber.Ctx) error {
        return c.SendString(&quot;Hello, World!&quot;)
    })

    app.Listen(&quot;:3000&quot;)
}
</code></pre>
<p>fiber 本质是对 Go 语言的<code>net/http</code>包的封装。</p>
<p>如果要获取参数，</p>
<pre><code class="language-go">app.Get(&quot;/hello/:name&quot;, func(c *fiber.Ctx) error {
    return c.SendString(&quot;Hello, &quot; + c.Params(&quot;name&quot;))
})
app.Get(&quot;/hello&quot;, func(c *fiber.Ctx) error {
    return c.SendString(&quot;Hello, &quot; + c.Query(&quot;name&quot;))
})
app.Post(&quot;/hello&quot;, func(c *fiber.Ctx) error {
    return c.SendString(&quot;Hello, &quot; + c.Body(&quot;name&quot;))
})
</code></pre>
<p>如果要发送 JSON 或者其他数据，</p>
<pre><code class="language-go">app.Get(&quot;/json&quot;, func(c *fiber.Ctx) error {
    return c.JSON(fiber.Map{&quot;message&quot;: &quot;Hello, World!&quot;})
})
app.Get(&quot;/file&quot;, func(c *fiber.Ctx) error {
    return c.SendFile(&quot;path/to/file&quot;)
})
</code></pre>
<p>可以看出来，fiber 和 hono 非常相似。</p>
<p>如果要使用数据库 client，</p>
<pre><code class="language-go">import &quot;github.com/jackc/pgx/v4&quot;

func main() {
    conn, err := pgx.Connect(context.Background(), &quot;postgresql://user:password@localhost:5432/database&quot;)
    if err != nil {
        log.Fatalf(&quot;Unable to connect to database: %v\n&quot;, err)
    }
    defer conn.Close()

    app.Get(&quot;/db&quot;, func(c *fiber.Ctx) error {
        rows, err := conn.Query(context.Background(), &quot;SELECT * FROM table&quot;)
        if err != nil {
            return err
        }
        defer rows.Close()

        var result []string
        for rows.Next() {
            var name string
            if err := rows.Scan(&amp;name); err != nil {
                return err
            }
            result = append(result, name)
        }

        return c.JSON(result)
    })

    app.Listen(&quot;:3000&quot;)
}
</code></pre>
<p>和 express 一样，fiber 也是使用回调捕获的方式来进行依赖注入。</p>
<h2 id="fastapi">FastAPI</h2>
<p>Python 有三个主要的 Web 框架，分别是 Django、Flask 和 FastAPI。FastAPI 是最新的一个，也是最快的一个。</p>
<pre><code class="language-python">from fastapi import FastAPI, APIRouter

app = FastAPI()

router = APIRouter()

@router.get(&quot;/&quot;)
async def read_root():
    return {&quot;Hello&quot;: &quot;World&quot;}

app.include_router(router, prefix=&quot;/api&quot;)

@app.get(&quot;/ping&quot;)
async def pong():
    return {&quot;ping&quot;: &quot;pong!&quot;}

if __name__ == &quot;__main__&quot;:
    import uvicorn
    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)
</code></pre>
<p>如果要获取参数，</p>
<pre><code class="language-python">@app.get(&quot;/hello/{name}&quot;)
async def hello(name: str):
    return {&quot;Hello&quot;: name}

@app.get(&quot;/hello&quot;)
async def hello(name: str):
    return {&quot;Hello&quot;: name}

class Item(BaseModel):
    name: str

@app.post(&quot;/hello&quot;)
async def hello(item: Item):
    return {&quot;Hello&quot;: item.name}
</code></pre>
<p>如果要做依赖注入，需要使用<code>Depends</code>，</p>
<pre><code class="language-python">from fastapi import Depends

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

@app.get(&quot;/db&quot;)
async def db(db: Session = Depends(get_db)):
    return db.query(Table).all()
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
