"use strict";(self.webpackChunknotes_template=self.webpackChunknotes_template||[]).push([[9336],{3201:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"11","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1 Seata","description":"Seata \u5c5e\u4e8e Spring Cloud Alibaba \u7684\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u4ecb\u7ecd\u5b83\u7684\u539f\u56e0\u662f Spring Cloud \u5b98\u65b9\u5e76\u6ca1\u6709\u63d0\u4f9b\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u800c Seata \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u5b83\u63d0\u4f9b\u4e86 AT\u3001TCC\u3001SAGA\u3001XA \u56db\u79cd\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u4e2d AT \u6a21\u5f0f\u662f\u6700\u5e38\u7528\u7684\u3002\u6211\u4eec\u53ea\u4ecb\u7ecd AT \u6a21\u5f0f\u3002","source":"@site/docs/11.md","sourceDirName":".","slug":"/11","permalink":"/micro-service-crashcourse/docs/11","draft":false,"unlisted":false,"editUrl":"https://github.com/finger-bone/micro-service-crashcourse/blob/main/docs/11.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"GateWay \u7f51\u5173","permalink":"/micro-service-crashcourse/docs/10"},"next":{"title":"Reactor","permalink":"/micro-service-crashcourse/docs/12"}}');var i=r(4848),t=r(8453);const o={},s="\u5206\u5e03\u5f0f\u4e8b\u52a1 Seata",c={},l=[{value:"\u4e8b\u52a1",id:"\u4e8b\u52a1",level:2},{value:"\u5206\u5e03\u5f0f\u4e8b\u52a1",id:"\u5206\u5e03\u5f0f\u4e8b\u52a1",level:2},{value:"Seata \u7684\u57fa\u672c\u539f\u7406",id:"seata-\u7684\u57fa\u672c\u539f\u7406",level:2},{value:"Seata \u7684\u914d\u7f6e",id:"seata-\u7684\u914d\u7f6e",level:2},{value:"\u542f\u52a8\u670d\u52a1",id:"\u542f\u52a8\u670d\u52a1",level:3},{value:"\u4fee\u6539\u914d\u7f6e",id:"\u4fee\u6539\u914d\u7f6e",level:3},{value:"Server \u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e",id:"server-\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e",level:3},{value:"Client \u4e8b\u52a1\u5206\u7ec4\u4e0e\u914d\u7f6e",id:"client-\u4e8b\u52a1\u5206\u7ec4\u4e0e\u914d\u7f6e",level:3},{value:"\u6570\u636e\u5e93\u914d\u7f6e",id:"\u6570\u636e\u5e93\u914d\u7f6e",level:3},{value:"Seata \u7684\u4f7f\u7528",id:"seata-\u7684\u4f7f\u7528",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u5206\u5e03\u5f0f\u4e8b\u52a1-seata",children:"\u5206\u5e03\u5f0f\u4e8b\u52a1 Seata"})}),"\n",(0,i.jsx)(n.p,{children:"Seata \u5c5e\u4e8e Spring Cloud Alibaba \u7684\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u4ecb\u7ecd\u5b83\u7684\u539f\u56e0\u662f Spring Cloud \u5b98\u65b9\u5e76\u6ca1\u6709\u63d0\u4f9b\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u800c Seata \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u5b83\u63d0\u4f9b\u4e86 AT\u3001TCC\u3001SAGA\u3001XA \u56db\u79cd\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u4e2d AT \u6a21\u5f0f\u662f\u6700\u5e38\u7528\u7684\u3002\u6211\u4eec\u53ea\u4ecb\u7ecd AT \u6a21\u5f0f\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u4e8b\u52a1",children:"\u4e8b\u52a1"}),"\n",(0,i.jsxs)(n.p,{children:["Spring \u4e2d\uff0c\u4e8b\u52a1\u662f\u6307\u7684\u662f\u4e00\u7ec4\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002\u5728 Spring \u4e2d\u4f7f\u7528\u4e8b\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"@Transactional"})," \u6ce8\u89e3\uff0c\u5b83\u53ef\u4ee5\u7528\u5728\u7c7b\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u7528\u5728\u65b9\u6cd5\u4e0a\uff0c\u7528\u5728\u7c7b\u4e0a\u8868\u793a\u7c7b\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u90fd\u662f\u4e8b\u52a1\u6027\u7684\uff0c\u7528\u5728\u65b9\u6cd5\u4e0a\u8868\u793a\u8be5\u65b9\u6cd5\u662f\u4e8b\u52a1\u6027\u7684\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\npublic class UserService {\n\n    @Autowired\n    private UserDao userDao;\n\n    @Transactional\n    public void add() {\n        userDao.add();\n        int i = 1 / 0;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u52a0\u4e0a\u8fd9\u4e2a\u6ce8\u89e3\u540e\uff0cSpring \u4f1a\u5728\u65b9\u6cd5\u6267\u884c\u524d\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u65b9\u6cd5\u6267\u884c\u540e\uff0c\u5982\u679c\u6ca1\u6709\u5f02\u5e38\uff0c\u4f1a\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5982\u679c\u6709\u5f02\u5e38\uff0c\u4f1a\u56de\u6eda\u4e8b\u52a1\u3002\u8fd9\u91cc\u7684\u56de\u6eda\u662f\u901a\u8fc7 AOP \u5b9e\u73b0\u7684\uff0cSpring \u4f1a\u5728\u65b9\u6cd5\u6267\u884c\u524d\u540e\u63d2\u5165\u4e00\u4e9b\u4ee3\u7801\uff0c\u8fd9\u4e9b\u4ee3\u7801\u5c31\u662f\u4e8b\u52a1\u7684\u5b9e\u73b0\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5206\u5e03\u5f0f\u4e8b\u52a1",children:"\u5206\u5e03\u5f0f\u4e8b\u52a1"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u4e8b\u52a1\u7684\u95ee\u9898\u4f1a\u66f4\u52a0\u590d\u6742\uff0c\u56e0\u4e3a\u4e8b\u52a1\u4e0d\u518d\u662f\u5728\u4e00\u4e2a\u6570\u636e\u5e93\u4e2d\uff0c\u800c\u662f\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e2d\u3002\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u4e8b\u52a1\u7684 ACID \u7279\u6027\uff0c"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u539f\u5b50\u6027\uff08Atomicity\uff09\uff1a\u4e8b\u52a1\u662f\u4e00\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u5de5\u4f5c\u5355\u4f4d\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002\u4f46\u662f\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u4e8b\u52a1\u53ef\u80fd\u4f1a\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u5c31\u9700\u8981\u4fdd\u8bc1\u6240\u6709\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u4e00\u81f4\u6027\uff08Consistency\uff09\uff1a\u4e8b\u52a1\u6267\u884c\u524d\u540e\uff0c\u6570\u636e\u7684\u5b8c\u6574\u6027\u6ca1\u6709\u88ab\u7834\u574f\u3002\u4f46\u662f\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u53ef\u80fd\u4f1a\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u5c31\u9700\u8981\u4fdd\u8bc1\u6240\u6709\u6570\u636e\u5e93\u7684\u6570\u636e\u4e00\u81f4\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u9694\u79bb\u6027\uff08Isolation\uff09\uff1a\u4e8b\u52a1\u4e4b\u95f4\u662f\u76f8\u4e92\u9694\u79bb\u7684\uff0c\u4e00\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u4e0d\u4f1a\u5f71\u54cd\u53e6\u4e00\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u3002\u4f46\u662f\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u4e8b\u52a1\u53ef\u80fd\u4f1a\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u5c31\u9700\u8981\u4fdd\u8bc1\u6240\u6709\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u4e4b\u95f4\u662f\u9694\u79bb\u7684\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u6301\u4e45\u6027\uff08Durability\uff09\uff1a\u4e8b\u52a1\u6267\u884c\u540e\uff0c\u6570\u636e\u662f\u6301\u4e45\u5316\u7684\u3002\u4f46\u662f\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u53ef\u80fd\u4f1a\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u5c31\u9700\u8981\u4fdd\u8bc1\u6240\u6709\u6570\u636e\u5e93\u7684\u6570\u636e\u662f\u6301\u4e45\u5316\u7684\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Seata \u4fbf\u662f\u4e00\u4e2a\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u89e3\u51b3\u65b9\u6848\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"seata-\u7684\u57fa\u672c\u539f\u7406",children:"Seata \u7684\u57fa\u672c\u539f\u7406"}),"\n",(0,i.jsx)(n.p,{children:"Seata \u6709\u4e09\u5927\u6838\u5fc3\u6982\u5ff5\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"TC\uff08Transaction Coordinator\uff09\uff1a\u4e8b\u52a1\u534f\u8c03\u5668\uff0c\u8d1f\u8d23\u4e8b\u52a1\u7684\u534f\u8c03\u548c\u5168\u5c40\u4e8b\u52a1\u7684\u7ba1\u7406\u3002\u5373 Seata \u672c\u8eab\u3002"}),"\n",(0,i.jsx)(n.li,{children:"TM\uff08Transaction Manager\uff09\uff1a\u4e8b\u52a1\u7ba1\u7406\u5668\uff0c\u8d1f\u8d23\u4e8b\u52a1\u7684\u5f00\u542f\u3001\u63d0\u4ea4\u3001\u56de\u6eda\u3002\u5373\u4e8b\u52a1\u7684\u53d1\u8d77\u8005\uff0c\u5b83\u8d1f\u8d23\u5b9a\u4e49\u5168\u5c40\u4e8b\u52a1\u7684\u8303\u56f4\uff0c\u5373\u8981\u64cd\u4f5c\u54ea\u4e9b\u6570\u636e\u5e93\u3002\u4e00\u822c\u662f\u7b2c\u4e00\u4e2a\u88ab\u8c03\u7684\uff0c\u5e26\u4e8b\u52a1\u6ce8\u89e3\u7684\u65b9\u6cd5\u3002"}),"\n",(0,i.jsx)(n.li,{children:"RM \uff08Resource Manager\uff09\uff1a\u8d44\u6e90\u7ba1\u7406\u5668\uff0c\u8d1f\u8d23\u7ba1\u7406\u5206\u652f\u4e8b\u52a1\u7684\u6ce8\u518c\u3001\u72b6\u6001\u6c47\u62a5\u3001\u56de\u6eda\u3002\u5373\u6570\u636e\u5e93\u672c\u8eab\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u6bcf\u4e2a Seata \u4e8b\u52a1\u7684\u751f\u547d\u5468\u671f\u5982\u4e0b\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"TM \u5f00\u542f\u4e00\u4e2a\u5168\u5c40\u4e8b\u52a1\uff0c\u751f\u6210\u4e00\u4e2a XID\uff08\u5168\u5c40\u4e8b\u52a1 ID\uff09\u3002"}),"\n",(0,i.jsx)(n.li,{children:"XID \u4f20\u9012\u7ed9 RM\uff0cRM \u751f\u6210\u4e00\u4e2a Branch ID\uff08\u5206\u652f\u4e8b\u52a1 ID\uff09\u3002"}),"\n",(0,i.jsx)(n.li,{children:"RM \u5f00\u542f\u4e00\u4e2a\u5206\u652f\u4e8b\u52a1\uff0c\u6267\u884c\u4e1a\u52a1\u903b\u8f91\u3002"}),"\n",(0,i.jsx)(n.li,{children:"RM \u5c06 Branch ID \u548c XID \u4f20\u9012\u7ed9\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u5c06 Branch ID \u548c XID \u4fdd\u5b58\u5230\u6570\u636e\u5e93\u4e2d\u3002"}),"\n",(0,i.jsx)(n.li,{children:"TM \u6536\u5230 RM \u7684\u8fd4\u56de\uff0c\u5982\u679c\u6240\u6709 RM \u90fd\u8fd4\u56de\u6210\u529f\uff0cTM \u63d0\u4ea4\u4e8b\u52a1\uff0c\u5982\u679c\u6709\u4e00\u4e2a RM \u8fd4\u56de\u5931\u8d25\uff0cTM \u56de\u6eda\u4e8b\u52a1\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e AT \u6a21\u5f0f\uff0c\u5177\u4f53\u800c\u8a00\uff0c\u662f\u901a\u8fc7\u9501\u548c\u4e24\u6b21\u63d0\u4ea4\u6765\u5b9e\u73b0\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u9636\u6bb5\uff0c\u4e1a\u52a1\u6570\u636e\u548c\u56de\u6eda\u65e5\u5fd7\u5728\u540c\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u4e2d\u63d0\u4ea4\uff0c\u5728\u63d0\u4ea4\u524d\u540e\uff0c\u4f1a\u8bb0\u5f55\u5feb\u7167\u3002\u7b2c\u4e00\u9636\u6bb5\u7ed3\u675f\u540e\uff0c\u4f1a\u751f\u6210\u884c\u9501\u3002\u7b2c\u4e00\u4e2a\u9636\u6bb5\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u672c\u5730\u4e8b\u52a1\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\u4e2a\u9636\u6bb5\uff0c\u5982\u679c\u6ca1\u6709\u5f02\u5e38\uff0c\u53ea\u8981\u5220\u9664\u7b2c\u4e00\u9636\u6bb5\u7684\u9501\u3001\u65e5\u5fd7\u3001\u5feb\u7167\u5373\u53ef\u3002\u5982\u679c\u6709\u5f02\u5e38\uff0c\u4f1a\u901a\u8fc7\u7b2c\u4e00\u9636\u6bb5\u7684\u65e5\u5fd7\u548c\u5feb\u7167\u8fdb\u884c\u56de\u6eda\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"seata-\u7684\u914d\u7f6e",children:"Seata \u7684\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3a\u4e86\u65b9\u4fbf\u90e8\u7f72\uff0c\u8fd9\u91cc\u4f9d\u7136\u4f7f\u7528 Docker\u3002\u4f46\u6ce8\u610f\uff0c\u4e00\u822c\u800c\u8a00\u6570\u636e\u5e93\u4e0d\u4f1a\u653e\u5728 Docker \u91cc\u3002\u5176\u5b83\u90e8\u7f72\u65b9\u5f0f\u89c1",(0,i.jsx)(n.a,{href:"https://seata.apache.org/docs/ops/deploy-guide-beginner",children:"\u6587\u6863"}),"\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u542f\u52a8\u670d\u52a1",children:"\u542f\u52a8\u670d\u52a1"}),"\n",(0,i.jsx)(n.p,{children:"\u9996\u5148\uff0c\u542f\u52a8\u4e00\u4e2a Seata \u670d\u52a1\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:'seata-server:\n    image: seataio/seata-server:2.0.0\n    ports:\n      - "7091:7091"\n      - "8091:8091"\n    depends_on:\n      - postgres\n      - consul\n    volumes:\n      - ./seata/application.yml:/seata-server/resources/application.yml\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4fee\u6539\u914d\u7f6e",children:"\u4fee\u6539\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"./seata/application.yml"}),"\u7684\u5177\u4f53\u5185\u5bb9\u8981\u6839\u636e\u4f60\u7684\u914d\u7f6e\u800c\u5b9a\uff0c\u6a21\u7248\u53ef\u4ee5\u5728\u5bb9\u5668\u5185\u7684",(0,i.jsx)(n.code,{children:"/seata-server/resources/application.example.yml"}),"\u627e\u5230\uff0c\u6216\u8005\u5728",(0,i.jsx)(n.a,{href:"https://github.com/apache/incubator-seata/blob/develop/server/src/main/resources/application.example.yml",children:"GitHub"}),"\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u7528 consul \u548c postgres\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"seata:\n  config:\n    # support: nacos \u3001 consul \u3001 apollo \u3001 zk  \u3001 etcd3\n    type: consul\n    consul:\n      server-addr: consul:8500\n      acl-token:\n      key: seata.properties\n  registry:\n    # support: nacos \u3001 eureka \u3001 redis \u3001 zk  \u3001 consul \u3001 etcd3 \u3001 sofa\n    type: consul\n    consul:\n      cluster: seata-server\n      server-addr: consul:8500\n      acl-token:\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u5b83\u7684\u914d\u7f6e\u90fd\u662f\u901a\u8fc7 Consul \u5b8c\u6210\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f\uff0c\u8fd9\u91cc register \u7684 cluster \u662f Consul \u7684\u670d\u52a1\u540d\uff0c\u4e4b\u540e\u6211\u4eec\u8981\u8981\u5728\u5ba2\u6237\u7aef\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528\u8fd9\u4e2a\u670d\u52a1\u540d\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"server-\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e",children:"Server \u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u4f7f\u7528\u670d\u52a1\u4e2d\u5fc3\u65b9\u5f0f\uff0c\u9700\u8981\u5728\u670d\u52a1\u4e2d\u5fc3\u8fdb\u884c\u914d\u7f6e\u3002\u4e0b\u6587\u4ee5 Consul \u4e3a\u4f8b\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u628a Consul \u4f5c\u4e3a seata \u6ce8\u518c\u5730\uff0c\u542f\u52a8 seata \u524d\uff0c\u5c06",(0,i.jsx)(n.a,{href:"https://github.com/apache/incubator-seata/blob/1.4.2/script/config-center/config.txt",children:"\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6"}),"\u63d0\u4ea4\u7ed9 consul\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684",(0,i.jsx)(n.a,{href:"https://github.com/apache/incubator-seata/blob/1.4.2/script/config-center/consul/consul-config.sh",children:"\u811a\u672c"}),"\uff0c\u8fdb\u5165\u5bb9\u5668\u5185\u4f7f\u7528\u3002\u6ce8\u610f\uff0cconfig.txt \u6587\u4ef6\u8981\u653e\u5728\u8fd9\u4e2a\u811a\u672c\u7684\u4e0a\u7ea7\u76ee\u5f55\u3002\u8fd9\u4e00\u6b65\u662f\u5c06 Consul \u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3\u9700\u8981\u7684\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f\uff0c\u56e0\u4e3a\u6211\u4eec\u7528\u4e86 postgres\uff0c\u8981\u4fee\u6539\u8fd9\u4e00\u90e8\u5206\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"store.db.datasource=druid\nstore.db.dbType=postgresql\nstore.db.driverClassName=org.postgresql.Driver\nstore.db.url=jdbc:postgresql://postgres:5432/seata\nstore.db.user=user\nstore.db.password=password\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u4e9b\u53c2\u6570\u7684\u542b\u4e49\u53c2\u8003\u8fd9\u4e2a",(0,i.jsx)(n.a,{href:"https://seata.apache.org/zh-cn/docs/user/configurations",children:"\u6587\u6863"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u800c\u5c06 Consul \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\uff0c\u8fd8\u8981\u521b\u5efa\u4e00\u4e2a",(0,i.jsx)(n.code,{children:"seata.properties"}),"\u6587\u4ef6\uff0c\u76ee\u524d\u7559\u7a7a\u5373\u53ef\uff0c\u56e0\u4e3a\u524d\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u5df2\u7ecf\u5305\u542b\u4e86\u6240\u6709\u914d\u7f6e\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"client-\u4e8b\u52a1\u5206\u7ec4\u4e0e\u914d\u7f6e",children:"Client \u4e8b\u52a1\u5206\u7ec4\u4e0e\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u4eec\u8bb2\u89e3\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u552f\u4e00\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u4e8b\u52a1\u5206\u7ec4\u3002\u4e8b\u52a1\u5206\u7ec4\u662f\u6307\u5c06\u4e00\u4e2a Seata \u96c6\u7fa4\u4e2d\u4e0d\u540c\u670d\u52a1\u5668\u5206\u6210\u82e5\u5e72\u7ec4\uff0c\u7136\u540e\u4e00\u4e9b\u5fae\u670d\u52a1\u4f1a\u4f7f\u7528\u67d0\u4e2a\u5206\u7ec4\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5728\u4e24\u4e2a\u670d\u52a1\u4e2d\u5f15\u5165 Seata Client \u7684\u4f9d\u8d56\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:"implementation 'io.seata:seata-spring-boot-starter:2.0.0'\nimplementation 'io.seata:seata-all:2.0.0'\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528 Spring Boot \u65f6\uff0c\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff0c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"seata:\n  registry:\n    type: consul\n    consul:\n      server-addr: 127.0.0.1:8500\n  # \u4e8b\u52a1\u5206\u7ec4\u914d\u7f6e\uff0c1.4.2 \u9ed8\u8ba4\u540d\u79f0\u4e3a my_test_tx_group \uff0c1.5\u7248\u672c\u5c06\u6539\u4e3a default_tx_group\n  tx-service-group: my_test_tx_group\n  service:\n    # \u4e8b\u52a1\u5206\u7ec4\u4e0e\u96c6\u7fa4\u6620\u5c04\u5173\u7cfb\n    vgroup-mapping:\n      my_test_tx_group: default\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5168\u90e8\u7684\u914d\u7f6e\u53ef\u4ee5\u89c1",(0,i.jsx)(n.a,{href:"https://github.com/apache/incubator-seata/blob/develop/script/client/spring/application.yml",children:"\u8fd9\u4e2a\u6587\u4ef6"}),"\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5177\u4f53\u800c\u8a00\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5fae\u670d\u52a1\uff0c\u5b83\u5728\u5bfb\u627e\u81ea\u5df1\u5bf9\u5e94\u7684 Seata \u670d\u52a1\u5668\u65f6\uff0c\u4f1a\u7ecf\u8fc7\u5982\u4e0b\u6b65\u9aa4\uff08\u5047\u8bbe\u4f7f\u7528 boot \u7248\u672c\uff09\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Client \u4f1a\u5148\u5728\u914d\u7f6e\u6587\u4ef6\u7684",(0,i.jsx)(n.code,{children:"seata.tx-service-group"}),"\u4e2d\u627e\u5230\u4e8b\u52a1\u5206\u7ec4\u7684\u540d\u5b57\u3002\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u662f my_test_tx_group\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["Client \u4f1a\u5728",(0,i.jsx)(n.code,{children:"seata.service.vgroupMapping.${seata.tx-service-group}"}),"\u4e2d\u627e\u5230\u8fd9\u4e2a\u5206\u7ec4\u5bf9\u5e94\u7684\u670d\u52a1\u540d\u3002\u8fd9\u4e2a\u503c\u8bb0\u4e3a\u5206\u7ec4\u540d",(0,i.jsx)(n.code,{children:"group-name"}),"\u3002\u5982\u679c\u4f7f\u7528\u8fdc\u7a0b\u914d\u7f6e\uff0c\u8fd9\u4e2a\u503c\u7684 key \u7701\u7565\u4e3a",(0,i.jsx)(n.code,{children:"service.vgroup-mapping.${seata.tx-service-group}"}),"\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["Client \u5728",(0,i.jsx)(n.code,{children:"service.grouplist.${group-name}"}),"\u627e\u5230\u8fd9\u4e2a\u5206\u7ec4\u7684\u670d\u52a1\u5668\u5730\u5740\u3002\u4f7f\u7528\u8fdc\u7a0b\u914d\u7f6e\u65f6\uff0c\u4f1a\u7528",(0,i.jsx)(n.code,{children:"${group-name}"}),"\u4f5c\u4e3a\u670d\u52a1\u540d\u53bb\u627e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u5168\u7528\u672c\u5730\u914d\u7f6e\uff0c\u5e94\u5f53\u8fd9\u6837\uff08type \u5b57\u6bb5\u9ed8\u8ba4\u90fd\u662f file\uff09\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"seata:\n  registry:\n    consul:\n      server-addr: localhost:8500\n  tx-service-group: tx_group\n  service:\n    vgroup-mapping:\n      tx_group: seata-group\n    grouplist:\n      seata-group: 127.0.0.1:8091\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u6211\u4eec\u4f7f\u7528 consul\uff0c\u5e94\u8be5\u8fd9\u6837\u914d\u7f6e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"seata:\n  config:\n    type: consul\n    consul:\n      server-addr: localhost:8500\n  registry:\n    type: consul\n    consul:\n      server-addr: localhost:8500\n  tx-service-group: tx_group\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u800c service \u90e8\u5206\u5e94\u5f53\u8fdc\u7a0b\u914d\u7f6e\uff0c\u5373\u5728 Consul \u7684 KV \u4e2d\uff0c\u6211\u4eec\u4e4b\u524d\u7684 config \u53ea\u6dfb\u52a0\u4e86\u9ed8\u8ba4\u7684\u914d\u7f6e\uff0c\u73b0\u5728\u8981\u6dfb\u52a0\u8fd9\u4e9b\u5b57\u6bb5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"service.vgroup-mapping.tx_group=seata-server\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u91cc seata-server \u662f\u6211\u4eec\u7684\u670d\u52a1\u540d\uff0c\u5373\u4e4b\u524d\u914d\u7f6e\u7684",(0,i.jsx)(n.code,{children:"cluster"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4f46\u662f\uff0c\u6ce8\u610f\uff0c\u76ee\u524d\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u4e86 docker \u914d\u7f6e\uff0c\u6240\u4ee5\u6211\u8fd9\u91cc\u83b7\u53d6\u7684 seata \u5730\u5740\u662f",(0,i.jsx)(n.code,{children:"172.18.0.5:8091"}),"\uff0c\u8fd9\u662f\u5bb9\u5668\u5185\u7684\u5730\u5740\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5982\u679c\u4ea7\u54c1\u4e5f\u662f\u8fd0\u884c\u5728 docker \u73af\u5883\u4e2d\uff0c\u53ea\u8981\u8bbe\u7f6e exposed \u5c31\u53ef\u4ee5\u4e86\u3002\u4f46\u662f\u73b0\u5728\u6211\u4eec\u7684\u4ea7\u54c1\u662f\u8fd0\u884c\u5728\u672c\u5730\u7684\uff0c\u800c seata \u8fd0\u884c\u5728 docker \u5185\uff0c\u8981\u4e48\u8ba9 docker \u7f51\u7edc\u548c\u672c\u5730\u7f51\u7edc\u76f8\u8fde\uff0c\u8981\u4e48\u628a\u4e00\u6574\u5957\u8fc1\u79fb\u5230\u672c\u5730\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u56e0\u6b64\u4e3a\u4e86\u907f\u514d\u9ebb\u70e6\uff0c\u4e0b\u9762\u7684\u6f14\u793a\u4f7f\u7528 file \u6a21\u5f0f\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u6570\u636e\u5e93\u914d\u7f6e",children:"\u6570\u636e\u5e93\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u540e\uff0cSeata \u9700\u8981\u4e00\u4e2a\u5355\u72ec\u7684\u6570\u636e\u5e93\uff0c\u7528\u4e8e\u4fdd\u5b58\u4e8b\u52a1\u4fe1\u606f\u3002\u8fd9\u4e2a\u6587\u4ef6\u53ef\u4ee5\u4ece Seata \u5b98\u65b9",(0,i.jsx)(n.a,{href:"https://github.com/apache/incubator-seata/tree/develop/script/server/db",children:"\u4e0b\u8f7d"}),"\uff0c\u7136\u540e\u81ea\u884c\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u540d\u4e3a",(0,i.jsx)(n.code,{children:"seata"}),"\u7684\u6570\u636e\u5e93\uff0c\u5bfc\u5165\u8fd9\u4e2a\u6587\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u521b\u5efa\u4e4b\u540e\uff0c\u5e94\u8be5\u6709\u8fd9\u6837\u7684\u8868\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"\u521b\u5efa seata \u8868",src:r(4840).A+"",width:"2998",height:"1800"})}),"\n",(0,i.jsx)(n.p,{children:"\u4e4b\u540e\uff0c\u91cd\u65b0\u542f\u52a8 Seata \u670d\u52a1\uff0c\u4f1a\u6709\u4e00\u4e9b\u9519\u8bef\uff0c\u4f46\u662f\u6700\u540e\u4f1a\u6210\u529f\u542f\u52a8\u3002Seata \u9700\u8981\u4e00\u70b9\u65f6\u95f4\u4ece Consul \u8bfb\u53d6\u4fe1\u606f\u3002\u6700\u540e\uff0c\u547d\u4ee4\u884c\u4e0a\u4f1a\u8f93\u51fa web \u754c\u9762\u7684\u5730\u5740\uff0c\u8bbf\u95ee\u8fd9\u4e2a\u5730\u5740\uff0c\u53ef\u4ee5\u770b\u5230 Seata \u7684\u63a7\u5236\u53f0\u3002Consul \u4e2d\u4e5f\u4f1a\u6709 Seata \u670d\u52a1\u7684\u6ce8\u518c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8f93\u5165 application.yml \u91cc\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u754c\u9762\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Seata \u63a7\u5236\u53f0",src:r(3990).A+"",width:"2978",height:"1658"})}),"\n",(0,i.jsx)(n.h2,{id:"seata-\u7684\u4f7f\u7528",children:"Seata \u7684\u4f7f\u7528"}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u4e86\u6d4b\u8bd5\uff0c\u6211\u4eec\u4eba\u4e3a\u6784\u9020\u4e00\u4e2a\u6ca1\u6709\u610f\u4e49\u7684\u4e8b\u52a1\u3002\u73b0\u5728\u521b\u5efa\u4e24\u4e2a\u6570\u636e\u8868\uff0c\u6bcf\u4e2a\u6570\u636e\u8868\u90fd\u6709\u4e00\u4e2a id\uff0c\u7b2c\u4e00\u4e2a\u6570\u636e\u8868\u6709\u4e00\u4e2a name\uff0c\u7b2c\u4e8c\u4e2a\u6570\u636e\u8868\u6709\u4e00\u4e2a age\u3002\u6211\u4eec\u8981\u4fdd\u8bc1\u8fd9\u4e24\u4e2a\u8868\u7684\u6570\u636e\u8981\u4e48\u540c\u65f6\u63d2\u5165\uff0c\u8981\u4e48\u540c\u65f6\u5220\u9664\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE name (\n    id SERIAL PRIMARY KEY,\n    name TEXT\n);\nCREATE TABLE age (\n    id SERIAL PRIMARY KEY,\n    age INT\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e\u521b\u5efa\u5bf9\u5e94\u7684 Repository \u548c Record\u3002\u56e0\u4e3a\u6211\u4eec\u8981\u6d4b\u8bd5\u7684\u573a\u666f\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u5373\u82e5\u5e72\u5fae\u670d\u52a1\u90fd\u64cd\u4f5c\u6570\u636e\u5e93\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u4eec\u5728\u4e4b\u524d\u7684\uff0c\u4f5c\u4e3a provider \u7684 payment \u670d\u52a1\u4e2d\uff0c\u63d0\u4f9b\u4e00\u4e2a\u65b0\u7684 API\uff0c\u8fd9\u4e2a API \u5e94\u5f53\u5411 name \u8868\u63d2\u5165\u6570\u636e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package io.github.fingerbone.entity;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.GeneratedValue;\nimport jakarta.persistence.GenerationType;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\n\n@Entity\n@Data\n@AllArgsConstructor\npublic class Name {\n    @Column\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column\n    private String name;\n}\n\npackage io.github.fingerbone.repository;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\nimport io.github.fingerbone.entity.Name;\n\n@Repository\npublic interface NameRepository extends JpaRepository<Name, Long> {\n    \n}\n\npackage io.github.fingerbone.service;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport io.github.fingerbone.entity.Name;\nimport io.github.fingerbone.repository.NameRepository;\nimport lombok.RequiredArgsConstructor;\n\n@Service\n@RequiredArgsConstructor\npublic class NameService {\n    private final NameRepository nameRepository;\n\n    public void createName(String name) {\n        System.out.println("Will create name with name: " + name);\n        nameRepository.save(\n            new Name(null, name)\n        );\n    }\n}\n\npackage io.github.fingerbone.controller;\n\nimport io.github.fingerbone.entity.Payment;\nimport io.github.fingerbone.record.PaymentRecord;\nimport io.github.fingerbone.service.NameService;\nimport io.github.fingerbone.service.PaymentService;\nimport io.github.fingerbone.wrapper.ResponseWrapper;\nimport lombok.RequiredArgsConstructor;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.DeleteMapping;\nimport org.springframework.web.bind.annotation.PutMapping;\n\nimport java.util.stream.Collectors;\nimport java.util.List;\n\n@RestController\n@RequestMapping("/payment")\n@RequiredArgsConstructor\npublic class PaymentController {\n    private final NameService nameService;\n\n    @PostMapping("/name")\n    public void createName(@RequestParam String name) {\n        nameService.createName(name);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e\u662f order \u670d\u52a1\uff0c\u8fd9\u4e2a\u670d\u52a1\u5e94\u5f53\u5411 age \u8868\u63d2\u5165\u6570\u636e\uff0c\u7136\u540e\u8bf7\u6c42 payment \u670d\u52a1\u63d2\u5165 name \u8868\u6570\u636e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@HttpExchange("http://payment-service/payment")\npublic interface PaymentAPIIf {\n\n    @PostExchange("/name")\n    void createName(@RequestParam String name);\n}\n\npackage io.github.fingerbone;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.GeneratedValue;\nimport jakarta.persistence.GenerationType;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\n\n@Entity\n@Data\n@AllArgsConstructor\npublic class Age {\n    @Id\n    @Column\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column\n    private Short age;\n}\n\npackage io.github.fingerbone;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface AgeRepository extends JpaRepository<Age, Long> {\n\n    \n}\n\npackage io.github.fingerbone;\n\nimport org.springframework.stereotype.Service;\n\nimport lombok.RequiredArgsConstructor;\n\n@Service\n@RequiredArgsConstructor\npublic class AgeService {\n    private final AgeRepository ageRepository;\n    private final PaymentAPIIf paymentAPIIf;\n\n    public void create(String name, Short age) {\n        System.out.println("Will create age with name: " + name + " and age: " + age);\n        ageRepository.save(\n            new Age(null, age)\n        );\n        System.out.println("Will create name with name: " + name);\n        paymentAPIIf.createName(name);\n    }\n}\n\npackage io.github.fingerbone;\n\n\nimport io.github.fingerbone.api.PaymentApi;\nimport io.github.fingerbone.record.PaymentRecord;\nimport io.github.fingerbone.wrapper.ResponseCode;\nimport io.github.fingerbone.wrapper.ResponseWrapper;\nimport io.github.resilience4j.bulkhead.annotation.Bulkhead;\nimport io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;\nimport lombok.Data;\nimport lombok.RequiredArgsConstructor;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpEntity;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.client.RestTemplate;\nimport org.springframework.core.ParameterizedTypeReference;\nimport org.springframework.http.HttpMethod;\n\nimport java.util.List;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\n\n\n@RestController\n@RequestMapping("/if/payment")\n@RequiredArgsConstructor\npublic class ConsumerPaymentController {\n    private final AgeService ageService;\n    @PostMapping("/age")\n    public void createAge(@RequestParam String name, @RequestParam Short age) {\n        ageService.create(name, age);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u73b0\u5728\uff0c\u542f\u52a8\u4e24\u4e2a\u670d\u52a1\uff0c\u8fdb\u884c\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u53d1\u73b0 name \u8868\u4e0e age \u8868\u53ef\u4ee5\u88ab\u6b63\u786e\u64cd\u4f5c\u4e86\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u73b0\u5728\uff0c\u6211\u4eec\u5e0c\u671b\u63d2\u5165 name \u548c age \u4f5c\u4e3a\u540c\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5373\u8981\u4e48\u540c\u65f6\u63d2\u5165\uff0c\u8981\u4e48\u540c\u65f6\u5220\u9664\u3002\u4e24\u4e2a\u5fae\u670d\u52a1\u7684\u4e24\u4e2a Service \u4f5c\u4e3a\u540c\u4e00\u4e2a\u4e8b\u52a1\u8fdb\u884c\u5904\u7406\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u53c2\u8003 Seata \u7684",(0,i.jsx)(n.a,{href:"https://seata.apache.org/docs/user/quickstart#step-2-create-undo_log-table",children:"\u6587\u6863"}),"\uff0c\u5728 AT \u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u5728\u9700\u8981\u4e8b\u52a1\u64cd\u4f5c\u7684\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u4e00\u4e2a",(0,i.jsx)(n.code,{children:"undo_log"}),"\u8868\u3002\u811a\u672c\u5728",(0,i.jsx)(n.a,{href:"https://github.com/apache/incubator-seata/blob/2.x/script/client/at/db",children:"\u8fd9\u91cc"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u4f7f\u7528 Seata\uff0c\u53ea\u9700\u8981\u4e3a TM \u65b9\u6cd5\u52a0\u4e0a",(0,i.jsx)(n.code,{children:"@GlobalTransactional"}),"\u6ce8\u89e3\u5373\u53ef\uff0c\u5373\u6574\u4e2a\u5fae\u670d\u52a1\u8c03\u7528\u94fe\u7684\u53d1\u8d77\u65b9\u6cd5\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@GlobalTransactional(name = "createUser", timeoutMills = 10000, rollbackFor = Exception.class)\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u73b0\u5728\uff0c\u5982\u679c\u5728\u88ab\u8c03\u5fae\u670d\u52a1\u4e2d\u624b\u52a8\u89e6\u53d1\u5f02\u5e38\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u5c3d\u7ba1\u547d\u4ee4\u884c\u4e2d\u8f93\u51fa\u4e86\u63d2\u5165\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u4f46\u6570\u636e\u5e93\u91cc\u5e76\u6ca1\u6709\u4fe1\u606f\uff0c\u8bf4\u660e\u89e6\u53d1\u4e86 Rollback\uff0c\u547d\u4ee4\u884c\u4e0a\u4e5f\u6709\u76f8\u5173\u7684\u8f93\u51fa\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5728 Seata \u7684\u63a7\u5236\u53f0\u4e0a\uff0c\u4e5f\u6709\u76f8\u5173\u8bb0\u5f55\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Seata \u6709\u8bb0\u5f55\u7684\u63a7\u5236\u53f0",src:r(4669).A+"",width:"3014",height:"956"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},3990:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/image-1-3bbb2d81ba6dad57e7506b0ce7b8f2f9.png"},4669:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/image-2-af0c93c0da4ba1edec5895b6aca9d73b.png"},4840:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/image-14b5da1db4458dae33636ff763633d3f.png"},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var a=r(6540);const i={},t=a.createContext(i);function o(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);